<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
  <title>Destroy In Handlers Test</title>
  
  <script src="Silverlight.js"></script>

  <script type="text/xaml" id="MouseEnterXaml">
    <Canvas xmlns="http://schemas.microsoft.com/client/2007"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            x:Name="root" Width="500" Height="50" Background="Orange" Loaded="MouseDownLoaded" MouseLeftButtonDown="DoStuff">
      <TextBlock x:Name="Log" Canvas.Top="10" Canvas.Left="10" TextWrapping="NoWrap" Width="400">
        <Run Text="Mouse down on this element"/><LineBreak/>
      </TextBlock>
    </Canvas>
  </script>

  <script type="text/xaml" id="SecondMouseEnterXaml">
    <Canvas xmlns="http://schemas.microsoft.com/client/2007"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            x:Name="root" Width="500" Height="50" Background="Orange" Loaded="MouseDownLoaded" MouseLeftButtonDown="DoStuff">
      <TextBlock x:Name="Log" Canvas.Top="10" Canvas.Left="10" TextWrapping="NoWrap" Width="400">
        <Run Text="Mouse down on this element"/><LineBreak/>
      </TextBlock>
    </Canvas>
  </script>

  <script type="text/javascript">
    function ReAddSilverlightControl (name)
    {
        var controlParent = document.getElementById ("SilverlightControlHost" + name);

        var control = document.getElementById ("SilverlightControl" + name);
	control.OnLoad = NewOnLoad;

        setTimeout(function() { alert ("hi"); control.Source = "#SecondMouseEnterXaml"; }, 500);

//        controlParent.removeChild (control);
//        controlParent.appendChild (control);
    }

    function MouseDownLoaded (sender, eventArgs)
    {
       alert ("MouseDownLoaded called (" + sender + ", " + eventArgs + ")");

        var control = document.getElementById ("SilverlightControlMouseEnter");
        alert ("onLoad = " + control.OnLoad);
        alert ("onError = " + control.OnError);
    }

    function DoStuff (sender, eventArgs)
    {
        ReAddSilverlightControl ("MouseEnter");
    }

    function OnLoaded(control, userContext, rootElement)
    {
        alert ("OnLoaded called (" + control + ", " + rootElement + ")");
    }

    function NewOnLoaded (control, userContext, rootElement)
    {
        alert ("NewOnLoaded called (" + control + ", " + rootElement + ")");
    }

    function NewOnLoad (sender, eventArgs)
    {
	alert ("NewOnLoad called (" + sender + ", " + eventArgs + ")");
    }

    function CreateSilverlightControl(name)
    {
        Silverlight.createObjectEx({
            source: ("#" + name + "Xaml"),
            parentElement: document.getElementById ("SilverlightControlHost" + name),
            id: "SilverlightControl" + name,
            properties: {
                width: "100%",
                height: "100%",
                version: "1.0",
                background: "#E0E0E0FF"
            },
            events: {
                  onLoad: OnLoaded
//                onError: OnError
            }
        });
    }
</script>
</head>
<body>

  <div id="SilverlightControlHostMouseEnter" style="position:absolute; top:150px; left:50px; width:500px; height:50px;"></div>

  <script type="text/javascript">
    CreateSilverlightControl ("MouseEnter");
  </script>
</body>
</html>
