<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>Test all asx files</title>    
    <script type="text/javascript">
		var files = [];
    </script>
    <script src="all.js" type="text/javascript"></script>
    <script src="Silverlight.js" type="text/javascript"></script>
    <script src="utils.js" type="text/javascript"></script>
</head>

<body onload="NextASX ();">

<div id="log"></div>
<div id="result"></div>
            
	<script type="text/javascript">
	var current = -1;
	var file = "";
	var timeout = null;
	var popup = null;
	var callbacks_done = 0;
	var failed_tests = 0;

	if (!Plugin.Silverlight)
		alert ("You have to generate the test results on Silverlight.");

	function callback ()
	{
		var result = document.getElementById ("result").innerHTML;
		callbacks_done++;

		if (callbacks_done > 60 && result == "")
			result = "Failed";

		if (result == "Success") {
			log ("   <div style='color:#00BB00;'>" + result + "</div>");
		} else if (result == "Failed") {
			log ("   <div style='color:#FF0000;'>" + result + "</div>");
			failed_tests++;
			if (failed_tests < 10)
				popup = null; // Don't keep more than 10 popups, when reacking a certain number ff blocks it no matter how you configure the pop-up blocker.
		} else {
			log (".");
			return;
		}
		clearInterval (timeout);
		NextASX ();
	}

	function NextASX ()
	{
		if (!Plugin.Silverlight)
			return;

		current++;
	
		if (popup != null) {
			popup.location.href = "";
		}

		if (files.length <= current) {
			popup.close ();
			popup = null;
			return;
		}
	
		if (popup == null)
			popup = window.open ("");

		file = files [current];
		file = file.replace (".asx", ".g.html");
		log ("Testing '" + file + "' (" + (current + 1) + "/" + files.length + ")");
		try {
			callbacks_done = 0;
			document.getElementById ("result").innerHTML = "";
			popup.location.href = file;
			timeout = setInterval ("callback ();", 1000);
		} catch (e) {
			log_line (e.toString ());
		}
	}

	function log_line (msg)
	{
		log (msg + "<BR/>");
	}
	
	function log (msg)
	{
		document.getElementById ("log").innerHTML += msg;
	}

	</script>  

</body>                
</html>

