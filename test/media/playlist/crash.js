files = [
"abstract-in-abstract.asx",
"abstract-in-asx.asx",
"abstract-in-entry.asx",
"asx-bannerbar-auto.asx",
"asx-bannerbar-fixed.asx",
"asx-bannerbar-invalid.asx",
"asx-invalid-attribute.asx",
"asx-invalid-version.asx",
"asx-lowercase.asx",
"asx-nested.asx",
"asx-nested-with-version.asx",
"asx-no-end-tag.asx",
"asx-no-version.asx",
"asx-previewmode-invalid.asx",
"asx-previewmode-no.asx",
"asx-previewmode-yes.asx",
"asx-version-03.0.asx",
"asx-version-2.0.asx",
"asx-version-3.00.asx",
"asx-version-3.0.asx",
"asx-version-3.asx",
"asx-version-3..asx",
"asx-version-4.0.asx",
"author-attribute.asx",
"author-in-asx.asx",
"author-in-author.asx",
"author-in-entry.asx",
"author-with-tag.asx",
"base-casemismatched-href.asx",
"base-in-asx.asx",
"base-in-asx-default.asx",
"base-in-base.asx",
"base-in-entry.asx",
"base-without-href.asx",
"base-without-href-with-invalid-attrib.asx",
"case-mismatched-asx-tag.asx",
"copyright-attribute.asx",
"copyright-in-asx.asx",
"copyright-in-asx-twice.asx",
"copyright-in-copyright.asx",
"copyright-in-entry.asx",
"copyright-with-tag.asx",
"deleted-entry.asx",
"duration-in-asx.asx",
"duration-in-duration.asx",
"duration-in-entry.asx",
"duration-in-entry-invalid.asx",
"duration-without-value.asx",
"empty.asx",
"endmarker-in-asx.asx",
"endmarker-in-entry.asx",
"endmarker-in-ref.asx",
"endmarker-with-invalid-number.asx",
"endmarker-with-name-and-number.asx",
"endmarker-with-name.asx",
"endmarker-with-number.asx",
"entry-attribute.asx",
"entry-in-asx.asx",
"entry-in-event.asx",
"entry-in-repeat.asx",
"entryref-in-asx.asx",
"entryref-in-entryref.asx",
"entryref-in-event.asx",
"entryref-in-repeat.asx",
"entryref-with-clientbind-invalid.asx",
"entryref-with-clientbind-no.asx",
"entryref-with-clientbind-yes.asx",
"entryref-without-href.asx",
"entry-with-clientskip-invalid.asx",
"entry-with-clientskip-no.asx",
"entry-with-clientskip-yes.asx",
"entry-with-skipifref-invalid.asx",
"entry-with-skipifref-no.asx",
"entry-with-skipifref-yes.asx",
"entry-with-text.asx",
"event.asx",
"event-with-entry.asx",
"event-with-entry-ref.asx",
"event-with-name-and-whendone-break.asx",
"event-with-name-and-whendone-invalid.asx",
"event-with-name-and-whendone-next.asx",
"event-with-name-and-whendone-resume.asx",
"event-with-name.asx",
"event-with-whendone.asx",
"inexistent-media.asx",
"invalid-media.asx",
"invalid-tag.asx",
"moreinfo-in-asx.asx",
"moreinfo-in-entry.asx",
"moreinfo-with-href-and-target.asx",
"moreinfo-with-href.asx",
"moreinfo-with-moreinfo.asx",
"moreinfo-with-target.asx",
"multiple-entries.asx",
"multiple-refs.asx",
"nested-1.asx",
"nested-2.asx",
"nested-3.asx",
"nested-4.asx",
"nested-5.asx",
"nested-6.asx",
"nested-7.asx",
"no-version.asx",
"param.asx",
"param-in-asx.asx",
"param-in-entry.asx",
"param-with-invalid-attribute.asx",
"param-with-name-and-value.asx",
"param-with-name.asx",
"param-with-param.asx",
"param-with-text.asx",
"param-with-value.asx",
"playlist.asx",
"ref.asx",
"ref-attribute.asx",
"ref-in-asx.asx",
"ref-with-duration.asx",
"ref-with-endmarker.asx",
"ref-with-invalid-attribute.asx",
"ref-without-href.asx",
"ref-with-ref.asx",
"ref-with-startmarker.asx",
"ref-with-starttime.asx",
"ref-with-tag.asx",
"ref-with-text.asx",
"repeat-in-asx.asx",
"repeat-in-entry.asx",
"repeat-with-entry.asx",
"repeat-with-entryref.asx",
"repeat-with-invalid-attribute.asx",
"repeat-with-number.asx",
"repeat-without-count.asx",
"repeat-with-repeat.asx",
"simple.asx",
"startmarker-in-asx.asx",
"startmarker-in-entry.asx",
"startmarker-in-entryref.asx",
"startmarker-in-ref.asx",
"startmarker-in-startmarker.asx",
"startmarker-with-text.asx",
"starttime-in-asx.asx",
"starttime-in-entry.asx",
"starttime-in-ref.asx",
"starttime-in-starttime.asx",
"starttime-in-twice.asx",
"starttime-with-invalid-attribute.asx",
"starttime-with-invalid-value.asx",
"starttime-without-value.asx",
"starttime-with-starttime.asx",
"starttime-with-text.asx",
"title-attribute.asx",
"title-in-asx.asx",
"title-in-author.asx",
"title-in-entry.asx",
"title-with-invalid-attribute.asx",
"title-with-tag.asx",
"title-with-title.asx",
"very-long-title.asx",
""
];
///////////////////////////////////////////////////////////////////////////////
//
//  Silverlight.js   			version 1.0
//
//  This file is provided by Microsoft as a helper file for websites that
//  incorporate Silverlight Objects. This file is provided under the Silverlight
//  SDK 1.0 license available at http://go.microsoft.com/fwlink/?linkid=94240.
//  You may not use or distribute this file or the code in this file except as
//  expressly permitted under that license.
//
//  Copyright (c) 2007 Microsoft Corporation. All rights reserved.
//
///////////////////////////////////////////////////////////////////////////////

if(!window.Silverlight)window.Silverlight={};Silverlight._silverlightCount=0;Silverlight.ua=null;Silverlight.available=false;Silverlight.fwlinkRoot="http://go.microsoft.com/fwlink/?LinkID=";Silverlight.StatusText="Get Microsoft Silverlight";Silverlight.EmptyText="";Silverlight.detectUserAgent=function(){var a=window.navigator.userAgent;Silverlight.ua={OS:"Unsupported",Browser:"Unsupported"};if(a.indexOf("Windows NT")>=0)Silverlight.ua.OS="Windows";else if(a.indexOf("PPC Mac OS X")>=0)Silverlight.ua.OS="MacPPC";else if(a.indexOf("Intel Mac OS X")>=0)Silverlight.ua.OS="MacIntel";if(Silverlight.ua.OS!="Unsupported")if(a.indexOf("MSIE")>=0){if(navigator.userAgent.indexOf("Win64")==-1)if(parseInt(a.split("MSIE")[1])>=6)Silverlight.ua.Browser="MSIE"}else if(a.indexOf("Firefox")>=0){var b=a.split("Firefox/")[1].split("."),c=parseInt(b[0]);if(c>=2)Silverlight.ua.Browser="Firefox";else{var d=parseInt(b[1]);if(c==1&&d>=5)Silverlight.ua.Browser="Firefox"}}else if(a.indexOf("Safari")>=0)Silverlight.ua.Browser="Safari"};Silverlight.detectUserAgent();Silverlight.isInstalled=function(d){var c=false,a=null;try{var b=null;if(Silverlight.ua.Browser=="MSIE")b=new ActiveXObject("AgControl.AgControl");else if(navigator.plugins["Silverlight Plug-In"]){a=document.createElement("div");document.body.appendChild(a);a.innerHTML='<embed type="application/x-silverlight" />';b=a.childNodes[0]}if(b.IsVersionSupported(d))c=true;b=null;Silverlight.available=true}catch(e){c=false}if(a)document.body.removeChild(a);return c};Silverlight.createObject=function(l,g,m,j,k,i,h){var b={},a=j,c=k;a.source=l;b.parentElement=g;b.id=Silverlight.HtmlAttributeEncode(m);b.width=Silverlight.HtmlAttributeEncode(a.width);b.height=Silverlight.HtmlAttributeEncode(a.height);b.ignoreBrowserVer=Boolean(a.ignoreBrowserVer);b.inplaceInstallPrompt=Boolean(a.inplaceInstallPrompt);var e=a.version.split(".");b.shortVer=e[0]+"."+e[1];b.version=a.version;a.initParams=i;a.windowless=a.isWindowless;a.maxFramerate=a.framerate;for(var d in c)if(c[d]&&d!="onLoad"&&d!="onError"){a[d]=c[d];c[d]=null}delete a.width;delete a.height;delete a.id;delete a.onLoad;delete a.onError;delete a.ignoreBrowserVer;delete a.inplaceInstallPrompt;delete a.version;delete a.isWindowless;delete a.framerate;if(Silverlight.isInstalled(b.version)){if(Silverlight._silverlightCount==0)if(window.addEventListener)window.addEventListener("onunload",Silverlight.__cleanup,false);else window.attachEvent("onunload",Silverlight.__cleanup);var f=Silverlight._silverlightCount++;a.onLoad="__slLoad"+f;a.onError="__slError"+f;window[a.onLoad]=function(a){if(c.onLoad)c.onLoad(document.getElementById(b.id),h,a)};window[a.onError]=function(a,b){if(c.onError)c.onError(a,b);else Silverlight.default_error_handler(a,b)};slPluginHTML=Silverlight.buildHTML(b,a)}else slPluginHTML=Silverlight.buildPromptHTML(b);if(b.parentElement)b.parentElement.innerHTML=slPluginHTML;else return slPluginHTML};Silverlight.supportedUserAgent=function(){var a=Silverlight.ua,b=a.OS=="Unsupported"||a.Browser=="Unsupported"||a.OS=="Windows"&&a.Browser=="Safari"||a.OS.indexOf("Mac")>=0&&a.Browser=="IE";return !b};Silverlight.buildHTML=function(c,d){var a=[],e,i,g,f,h;if(Silverlight.ua.Browser=="Safari"){a.push("<embed ");e="";i=" ";g='="';f='"';h=' type="application/x-silverlight"/>'+"<iframe style='visibility:hidden;height:0;width:0'/>"}else{a.push('<object type="application/x-silverlight"');e=">";i=' <param name="';g='" value="';f='" />';h="</object>"}a.push(' id="'+c.id+'" width="'+c.width+'" height="'+c.height+'" '+e);for(var b in d)if(d[b])a.push(i+Silverlight.HtmlAttributeEncode(b)+g+Silverlight.HtmlAttributeEncode(d[b])+f);a.push(h);return a.join("")};Silverlight.default_error_handler=function(e,b){var d,c=b.ErrorType;d=b.ErrorCode;var a="\nSilverlight error message     \n";a+="ErrorCode: "+d+"\n";a+="ErrorType: "+c+"       \n";a+="Message: "+b.ErrorMessage+"     \n";if(c=="ParserError"){a+="XamlFile: "+b.xamlFile+"     \n";a+="Line: "+b.lineNumber+"     \n";a+="Position: "+b.charPosition+"     \n"}else if(c=="RuntimeError"){if(b.lineNumber!=0){a+="Line: "+b.lineNumber+"     \n";a+="Position: "+b.charPosition+"     \n"}a+="MethodName: "+b.methodName+"     \n"}alert(a)};Silverlight.createObjectEx=function(b){var a=b,c=Silverlight.createObject(a.source,a.parentElement,a.id,a.properties,a.events,a.initParams,a.context);if(a.parentElement==null)return c};Silverlight.buildPromptHTML=function(i){var a=null,f=Silverlight.fwlinkRoot,c=Silverlight.ua.OS,b="92822",d;if(i.inplaceInstallPrompt){var h;if(Silverlight.available){d="94376";h="94382"}else{d="92802";h="94381"}var g="93481",e="93483";if(c=="Windows"){b="92799";g="92803";e="92805"}else if(c=="MacIntel"){b="92808";g="92804";e="92806"}else if(c=="MacPPC"){b="92807";g="92815";e="92816"}a='<table border="0" cellpadding="0" cellspacing="0" width="205px"><tr><td><img title="Get Microsoft Silverlight" onclick="javascript:Silverlight.followFWLink({0});" style="border:0; cursor:pointer" src="{1}"/></td></tr><tr><td style="background:#C7C7BD; text-align: center; color: black; font-family: Verdana; font-size: 9px; padding-bottom: 0.05cm; ;padding-top: 0.05cm" >By clicking <b>Get Microsoft Silverlight</b> you accept the <a title="Silverlight License Agreement" href="{2}" target="_top" style="text-decoration: underline; color: #36A6C6"><b>Silverlight license agreement</b></a>.</td></tr><tr><td style="border-left-style: solid; border-right-style: solid; border-width: 2px; border-color:#c7c7bd; background: #817d77; color: #FFFFFF; text-align: center; font-family: Verdana; font-size: 9px">Silverlight updates automatically, <a title="Silverlight Privacy Statement" href="{3}" target="_top" style="text-decoration: underline; color: #36A6C6"><b>learn more</b></a>.</td></tr><tr><td><img src="{4}"/></td></tr></table>';a=a.replace("{2}",f+g);a=a.replace("{3}",f+e);a=a.replace("{4}",f+h)}else{if(Silverlight.available)d="94377";else d="92801";if(c=="Windows")b="92800";else if(c=="MacIntel")b="92812";else if(c=="MacPPC")b="92811";a='<div style="width: 205px; height: 67px; background-color: #FFFFFF"><img onclick="javascript:Silverlight.followFWLink({0});" style="border:0; cursor:pointer" src="{1}" alt="Get Microsoft Silverlight"/></div>'}a=a.replace("{0}",b);a=a.replace("{1}",f+d);return a};Silverlight.__cleanup=function(){for(var a=Silverlight._silverlightCount-1;a>=0;a--){window["__slLoad"+a]=null;window["__slError"+a]=null}if(window.removeEventListener)window.removeEventListener("unload",Silverlight.__cleanup,false);else window.detachEvent("onunload",Silverlight.__cleanup)};Silverlight.followFWLink=function(a){top.location=Silverlight.fwlinkRoot+String(a)};Silverlight.HtmlAttributeEncode=function(c){var a,b="";if(c==null)return null;for(var d=0;d<c.length;d++){a=c.charCodeAt(d);if(a>96&&a<123||a>64&&a<91||a>43&&a<58&&a!=47||a==95)b=b+String.fromCharCode(a);else b=b+"&#"+a+";"}return b}

;
function ErrorEventArgsToString (errorArgs)
{
    var errorMsg = "";
    
	if (errorArgs == null)
		return "null";

    // Error information common to all errors.
    errorMsg += "Error Type:    " + errorArgs.errorType + "\n";
    errorMsg += "Error Message: " + errorArgs.errorMessage + "\n";
    errorMsg += "Error Code:    " + errorArgs.errorCode + "\n";
    
    // Determine the type of error and add specific error information.
    switch (errorArgs.errorType)  {
    case "RuntimeError":
        // Display properties specific to RuntimeErrorEventArgs.
        if (errorArgs.lineNumber != 0)
        {
            errorMsg += "Line: " + errorArgs.lineNumber + "\n";
            errorMsg += "Position: " +  errorArgs.charPosition + "\n";
        }
        errorMsg += "MethodName: " + errorArgs.methodName + "\n";
        break;
    case "ParserError":
        // Display properties specific to ParserErrorEventArgs.
        errorMsg += "Xaml File:      " + errorArgs.xamlFile      + "\n";
        errorMsg += "Xml Element:    " + errorArgs.xmlElement    + "\n";
        errorMsg += "Xml Attribute:  " + errorArgs.xmlAttribute  + "\n";
        errorMsg += "Line:           " + errorArgs.lineNumber    + "\n";
        errorMsg += "Position:       " + errorArgs.charPosition  + "\n";
        break;
    default:
        break;
    }
	return errorMsg;	
}

function ErrorEventArgsToOneLineString (errorArgs)
{
    var errorMsg = "";
    
	if (errorArgs == null)
		return "null";

    // Error information common to all errors.
    errorMsg += "Error Type:    " + errorArgs.errorType;
    errorMsg += ", " + "Error Message: " + errorArgs.errorMessage;
    errorMsg += ", " + "Error Code:    " + errorArgs.errorCode;
    
    // Determine the type of error and add specific error information.
    switch (errorArgs.errorType)  {
    case "RuntimeError":
        // Display properties specific to RuntimeErrorEventArgs.
        if (errorArgs.lineNumber != 0)
        {
            errorMsg += ", " + "Line: " + errorArgs.lineNumber;
            errorMsg += ", " + "Position: " +  errorArgs.charPosition;
        }
        errorMsg += ", " + "MethodName: " + errorArgs.methodName;
        break;
    case "ParserError":
        // Display properties specific to ParserErrorEventArgs.
        errorMsg += ", " + "Xaml File:      " + errorArgs.xamlFile;
        errorMsg += ", " + "Xml Element:    " + errorArgs.xmlElement;
        errorMsg += ", " + "Xml Attribute:  " + errorArgs.xmlAttribute;
        errorMsg += ", " + "Line:           " + errorArgs.lineNumber;
        errorMsg += ", " + "Position:       " + errorArgs.charPosition;
        break;
    default:
        break;
    }
	return errorMsg;	
}

var Host = {
	Windows: navigator.userAgent.indexOf ('Windows') > -1,
	//Linux: navigator.userAgent.indexOf ('Linux') > -1,
	X11: navigator.userAgent.indexOf ('X11') > -1,
	Mac: navigator.userAgent.indexOf ('Macintosh') > -1
};

var Plugin = {
	Silverlight: Host.Windows || Host.Mac,
	Moonlight: Host.X11
};

function is1_0 (plugin)
{
	return plugin.IsVersionSupported ("1.0") && !plugin.IsVersionSupported ("1.1");
}

function is1_1 (plugin)
{
	return plugin.IsVersionSupported ("1.1") && !plugin.IsVersionSupported ("1.2");
}

function is2_0 (plugin)
{
	return plugin.IsVersionSupported ("2.0") && !plugin.IsVersionSupported ("2.1");
}

var me = null;
var current = -1;
var file = "";
var plugin = null;
var top = null;
var timeout = null;

var printf_counter = 0;
var complete_log = [];

var test_plugin = null;

function printf (message, action) {
	if (!Plugin.Silverlight) {
		if (action != "create")
			return;
		action = "printf"
		message = "Not creating any test results, we're executing with Moonlight.";
	}
		
	var client = new XMLHttpRequest();
try {
	client.open("POST", "printf.aspx?file=" + file + ".js&action=" + action, false);
	client.setRequestHeader("Content-Type", "text/plain;charset=UTF-8");
	client.send(message);
} catch {
}
}

function printf_formatted (message, action) {
	printf ("    \"" + message + "\", \n", action);
}

function log_to_div (msg)
{
	document.getElementById ("log").innerHTML += msg + "<BR/>";
}

function log (msg)
{
	log_to_div (msg);
	printf_formatted (msg, "append");
	complete_log.push (msg);
}

function logAttributes (media)
{
	log (" Attributes: " + media.Attributes + " Attributes.Count: " + media.Attributes.Count);

	for (var i = 0; i < media.Attributes.Count; i++) {
		var attribute = media.Attributes.GetItem (i);
		log (" #" + (i + 1).toString ( ) + ": Name = '" + attribute.Name + "', Value = '" + attribute.Value + "'");
	}
	log (" Source: " + media.Source);
	log (" NaturalDuration: " + Math.round (media.NaturalDuration.Seconds * 100) / 100);
	log ("<hr />");
}

function OnTestFinished ()
{
	printf ("    \"\"\n", "append");
	printf ("];\n", "append");

	var failed = true;

	complete_log.push ("");

	log_to_div ("");
	log_to_div ("");

	if (result.length != complete_log.length) {
		log_to_div ("Test failed, result.length (" + result.length + ") != complete_log.length (" + complete_log.length + ")");
	} else {
		failed = false;
		for (i = 0; i < result.length; i++) {
			if (result [i].length != complete_log [i].length) {
				log_to_div ("Test failed: at index " + i + " expected length " + result [i].length + " and got length " + complete_log [i].length + "");
				log_to_div ("    " + result [i]);
				log_to_div ("    " + complete_log [i]);
				failed = true;
			} else if (result [i] != complete_log [i]) {
				log_to_div ("Test failed: at index " + i + " expected [" + result [i] + "] and got [" + complete_log [i] + "]");
				failed = true;
			}
		}
	}

	if (failed) {
		log_to_div ("expected output:");
		for (i = 0; i < result.length; i++)
			log_to_div (result [i]);
		log_to_div ("actual output:");
		for (i = 0; i < complete_log.length; i++)
			log_to_div (complete_log [i]);
	}

	if (!failed)
		log_to_div ("Test succeeded");

	if (window.opener)
		window.opener.document.getElementById ("result").innerHTML = failed ? "Failed" : "Success";

	var TestLogger = test_plugin.GetLogProvider;

	if (failed) {
		TestLogger.LogError ("Some error occured.");
		TestLogger.LogResult (-1);
	} else {
		TestLogger.LogResult (0);
	}

	test_plugin.SignalShutdown ();
}

function OnMediaOpened (e, args)
{
	clearTimeout (timeout);
	log ("OnMediaOpened (" + e + " [" + e.Source + "], " + args + ")");
	logAttributes (e);
	OnTestFinished ();
}

function OnMediaFailed (e, args)
{
	clearTimeout (timeout);
	log ("OnMediaFailed (" + e + " [" + e.Source + "], " + args + " [" + ErrorEventArgsToOneLineString (args) + "])");
	OnTestFinished ();
}

function OnPluginError (e, args)
{
	clearTimeout (timeout);
	log ("OnError (" + e + ", " + args + ")");
	OnTestFinished ();
}

function OnCurrentStateChanged (e, args)
{
	//log ("OnCurrentStateChanged (" + e + " [" + e.Source + "], " + args + "): state: " + e.CurrentState);
}

function callback ()
{
	log ("Timedout: [" + me.Source + "]");
	OnTestFinished ();
}

function NextASX ()
{
	current++;

	clearTimeout (timeout);

	if (file != "")
		return;

	file = asx_file;

	printf ("", "create");
//	printf ("// Moonlight: " + Plugin.Moonlight + "\n", "append");
//	printf ("// Silverlight: " + Plugin.Silverlight + "\n", "append");
	printf ("var result = [\n", "append");
	log ("Opening: " + asx_file);

	timeout = setTimeout ("callback ()", 2000);
	top.Children.Clear ();
	me = plugin.content.createFromXaml ("<MediaElement Name=\"MediaPlayer\" Width=\"300\" Height=\"300\" MediaFailed=\"OnMediaFailed\" MediaOpened=\"OnMediaOpened\" CurrentStateChanged=\"OnCurrentStateChanged\"/>");
	top.Children.Add (me);
	me.Source = file;
}

function OnPluginLoad (e, args)
{
	test_plugin = document.getElementById ("_TestPlugin");

	plugin = e;
	top = e.content.findName ("Top");
	NextASX ();
}

Silverlight.createObject (
"all.xaml", document.getElementById("PlaylistHost"), "Player",
{
	width:'10',
	height:'10',
	inplaceInstallPrompt:false,
	background:'green',
	isWindowless:'false',
	framerate:'24',
	version:'1.0'
},
    {
	onError: OnPluginError,
	onLoad: OnPluginLoad
},
	null
);
var result = [
    "Opening: very-long-title.asx", 
    "OnMediaOpened (MediaElement [very-long-title.asx], RoutedEventArgs)", 
    " Attributes: MediaAttributeCollection Attributes.Count: 3", 
    " #1: Name = 'TITLE', Value = 'Short timecode video'", 
    " #2: Name = 'COPYRIGHT', Value = '(c) 2008 Novell, Inc'", 
    " #3: Name = 'AUTHOR', Value = 'Novell, Inc'", 
    " Source: very-long-title.asx", 
    " NaturalDuration: 2.05", 
    "<hr />", 
    ""
];
