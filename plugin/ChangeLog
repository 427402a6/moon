2007-06-11  Everaldo Canuto  <ecanuto@novell.com>

	* plugin.cpp: Fix object creation using NPN_RetainObject to increment
	reference count as described in Mozilla documentation.

	* plugin-class.cpp: On ClassDeallocate uses NPN_ReleaseObject that
	checks for references and release object when reference count is equal
	zero. It see to be solve all remaining segfault when browser closes.

2007-06-11  Everaldo Canuto  <ecanuto@novell.com>

	[Refactory jscript runtime code]

	* plugin-class.cpp, plugin-class.h: Create new class PluginRootClass,
	to be a proxy for javascript runtime calls, old code on plugin instance
	was moved here and all segfault related to script stuff was gone.

	* plugin.cpp, plugin.h: Remove jscript runtime related code and use
	PluginRootClass.

2007-06-11  Everaldo Canuto  <ecanuto@novell.com>

	* moon-mono.cpp,
	* mono.cpp,
	* plugin.h: Fix remaining config.h -> moonlight.h.

2007-06-11  Everaldo Canuto  <ecanuto@novell.com>

	* moonlight.h: Define RUNTIME to enable/disable mono runtime 
	integration. Its because right now it fails when open a page with 
	script so we can comment /#define RUNTIME to get plugin working in
	old way.

	* plugin.cpp: Dont call vm_load_xaml when RUNTIME is not defined.

	* plugin-glue.cpp: Dont call vm_init when RUNTIME is not defined.

2007-06-11  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp: Renamed to plugin.cpp.
	* moon-plugin.h: Renaned to plugin.h.
	* config.h: Renaned to moonlight.h.

	* plugin-class.h, plugin-glue.cpp: Update includes.

2007-06-11  Miguel de Icaza  <miguel@novell.com>

	* Makefile.am: Delete the ~/.mozilla/plugins/libmoon.so in case it
	was around, that was the painful bug.

	* moon-plugin.cpp (CreateWindow): Do not create a canvas, nor
	attach it, let Mono do that. 
	(StreamAsFile): Request that the VM loads the file, this will
	change to something else later when we use the Silverlight object
	embedding API.

	* moonlight.cs: Implement some bits, it currently only loads the
	XAML file, it needs to create a new appdomain.

2007-06-11  Everaldo Canuto  <ecanuto@novell.com>

	* Makefile.am,
	* moon-mono.cpp,
	* mono.cpp: Rename moon.cpp to moon-mono.cpp.

	* moon-mono.h: Add header information.

	* plugin-glue.cpp,
	* config.h: Add constant MOON_1_0 and MOON_1_1, when 1.1 is define 
	compile also mono runtime, it is disabled by default since mono runtime
	give us some crashes right now.

2007-06-10  Everaldo Canuto  <ecanuto@novell.com>

	* Makefile.am: config.h added.

	* config.h: Added.

	* plugin-class.cpp,
	* moon-plugin.cpp,
	* plugin-class.h,
	* plugin-glue.cpp,
	* moon-plugin.h: Include config.h and remove unneeded includes.

2007-06-10  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp: Remove DEMO mode and set SCRIPTING mode by default.

2007-06-10  Miguel de Icaza  <miguel@novell.com>

	* moonlight.cs: the startup code, will contain the helper classes
	to create new AppDomains for each instance create.

	* mono.cpp: New file, embeds the Mono VM.

2007-06-10  Everaldo Canuto  <ecanuto@novell.com>

	* plugin-glue.cpp: Call plugin instance destructor, now it dont causes
	error when you reload page.

	* moon-plugin.cpp: Only destroy container widget, if you dont destroy it
	when you start with page plugin, go to another page and close browser,
	a segfault is emited before browser exits. Now navigating for some time in
	silverlight pages looks to dont emit segfault if scripting is disabled.

	* plugin-class.cpp: Remove debug message from class constructor.

2007-06-09  Everaldo Canuto  <ecanuto@novell.com>

	[Xaml support]

	* moon-plugin.cpp: 
	- Read xaml file from src tag and display contents.
	- Disable demo box, now we have a better demo under xaml file.

2007-06-09  Everaldo Canuto  <ecanuto@novell.com>

	* Makefile.am: test added to subdirs.

2007-06-09  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp,
	* plugin-glue.cpp,
	* moon-plugin.h: Rename DEBUG to DEBUGMSG.

2007-06-08  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.h,
	* moon-plugin.cpp: Change demo code to class method CreateDemoControls.

2007-06-08  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp: Add canvas, connect it to surface and get demo working
	back.

2007-06-08  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.h,
	* moon-plugin.cpp: Rename CreateControls to CreateWindow.

2007-06-08  Everaldo Canuto  <ecanuto@novell.com>

	* Makefile.am: Add $(MOON_LIBS) to linker options.

2007-06-08  Everaldo Canuto  <ecanuto@novell.com>

	* plugin-glue.cpp: Dont delete plugin object since right now it causes some
	segfault when change to another page.

	* moon-plugin.cpp: Got scripting mode enabled by default.

2007-06-08  Everaldo Canuto  <ecanuto@novell.com>

	* plugin-glue.cpp: Fix plugin destruction.
	* moon-plugin.cpp: Change button to gtk label with plugin name and version.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	* plugin-glue.cpp: Set instance data to NULL to prevent error when browser
	closes.

	* moon-plugin.cpp: 
	- Disabled demo mode.
	- Enabled Scripting mode.
	- Fix runtime object creation, dont user NPN_RetainObject anymore.
	- Fix also object properties creation (settings).
	- Release object on class destructor.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp: Simplify controls creation and add a button when you are
	not in demo mode. It is just for now to made some tests.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp: Remove runtime initialization because it is wrong place.
	* plugin-glue.cpp: Add gtk and runtime initialization to NPP_Initialize.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp: Add some initialization code to prevent some segmentation
	fault.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp: Add SCRIPTING and DEMO macros to make available only
	tested features, it mean that developers must uncomment this MACRO lines
	before work on scripting and libmoon stuff.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp: Fix gtkplug creation fro 64bit systems. 

	* Makefile.am: Add -lavformat to link options.

	Thanks Grendel for this patches.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.h: Change version number 0.99.0, SilverLight scripts searchs 
	for version > 0.95.1.

	* test/index.html: Small fixes in test page.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	* test/index.html: Add javascript settings test.

	* moon-plugin.cpp,
	* moon-plugin.h: Implementing Settings class.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp,
	* moon-plugin.h: Implement runtime properties structure and 'version'
	property.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	[PluginClass added to handle script objects]

	* plugin-class.cpp,
	* plugin-class.h,
	* Makefile.am: PluginClass added.

	* moon-plugin.cpp, 
	* moon-plugin.h: PluginInstance now inherit from PluginClass, also 
	scriptclass was removed and "this" is used in NPN_CreateObject. For
	NPN_CreateObject we can now always use classes inherited by PluginClass.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	* Makefile.am: Remove idl related code, new object system dont need idl or
	xpi files. 
	* nsIScriptableMoonPlugin.h: deleted.
	* nsIScriptableMoonPlugin.idl: deleted.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	* plugin-glue.cpp: Fix the instance initialization problems, the object 
	instance was empty after creation.

2007-06-07  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp, 
	* moon-plugin.h,
	* plugin-glue.cpp: Fix SetValue declaration.

	* plugin-entry.cpp: Fix a lot of declarations, support for win and mac,
	support for runtime version checking and some other minor fixes.

2007-06-06  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp: Comment container destructor to prevent segfault.

2007-06-06  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp: Fix API change for Canvas.

2007-06-06  Sebastien Pouliot  <sebastien@ximian.com> 

	* moon-plugin.cpp: Fix API change for SolidColorBrush.

2007-06-05  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.h: Add PLUGIN_OURNAME and PLUGIN_OURVERSION constants to 
	specify our internal name and version that differs from plugin version 
	detected by browser. SilverLight javascripts checks for WPF plugin and
	0.8.5.0 version.

	* moon-plugin.cpp: Change runtime initialization to CreateControls, before
	show demo.

	* plugin-glue.cpp: Fix memory allocation problems in NPP_New.

2007-06-05  Everaldo Canuto  <ecanuto@novell.com>

	* plugin-glue.cpp,
	* moon-plugin.cpp,
	* moon-plugin.h: Add initialization and remove demo transformation.

2007-06-05  Everaldo Canuto  <ecanuto@novell.com>

	[Remove ScriptablePeer code]

	* nsScriptablePeer.h, nsScriptablePeer.cpp: Removed.

	* plugin-glue.cpp: Fix debugger messages.

	* Makefile.am, 
	* moon-plugin.cpp,
	* moon-plugin.h: Remove ScriptablePeer code since now Mozilla use
	another aproach.

2007-06-05  Sebastien Pouliot  <sebastien@ximian.com> 

	* moon-plugin.cpp: Fix API change for Rectangle.

2007-06-05  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin-glue.cpp: Splited in plugin-glue.cpp and plugin-entry.cpp.
	* plugin-glue.cpp: Fix 'undefined symbol' creating NPP_SetValueX.

2007-06-05  Everaldo Canuto  <ecanuto@novell.com>

	* Makefile.am: Add some linker flags, it prevents crash on Epiphany.

2007-06-05  Everaldo Canuto  <ecanuto@novell.com>

	* test/index.html: Add script to demo html page.

2007-06-05  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.cpp: Add runtime init to demo code.

2007-06-04  Everaldo Canuto  <ecanuto@novell.com>

	* plugin/Makefile.am: Generate and install .xpt for install-plugin target.

2007-06-04  Everaldo Canuto  <ecanuto@novell.com>

	[Implement scriptable to plugin]

	* plugin/test/index.html: Sample jscript included.

	* plugin/Makefile.am: Generates .h from idl file use xpidl.

	* plugin/moon-plugin.h,
	* plugin/moon-plugin.cpp,
	* plugin/moon-plugin-glue.cpp: Implement scriptable and some clean up.

	* plugin/nsIScriptableMoonPlugin.h,
	* plugin/nsIScriptableMoonPlugin.idl,
	* plugin/nsScriptablePeer.cpp,
	* plugin/nsScriptablePeer.h: New scriptable classes.

2007-06-03  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin-glue.cpp,
	* moon-plugin.h,
	* moon-plugin.cpp: Fix GetValue and implement SetValue.

2007-06-03  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.h: Change plugin name, version and description to mimic 
	SilverLight and can be recognize as a valid plugin.

2007-06-03  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.c: Destroy objects on class destructor to prevent browser
	crashes.

2007-06-03  Everaldo Canuto  <ecanuto@novell.com>

	[Clean up demo and make some class fields private ]

	* moon-plugin-glue.c,
	* moon-plugin.h,
	* moon-plugin.c: Now just a surface control is added to plugn container,
	some field is now private demo was refactored.

2007-06-03  Everaldo Canuto  <ecanuto@novell.com>

	* Makefile.am: Compile if needed for install-plugin target.

2007-06-03  Everaldo Canuto  <ecanuto@novell.com>

	[Move to c++ based classes ]
	
	* moon-plugin-glue.c: Fix getvalue to return error when no instance 
	available.

	* moon-plugin.h,
	* moon-plugin.c: Change all function to class methods, also move wrapper
	functions to moon-plugin-glue.

2007-06-03  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.h,
	* moon-plugin.c,
	* moon-plugin-glue.c: Remove moon_plugin_initialize and moon_plugin_shutdown
	since whe alread have NP_Initialize and NP_Shutdown. Also change 
	PluginInstance structure to class (complete class suppont comming soon).

2007-06-03  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin-glue.c: Some comments and stetic changes.

2007-06-03  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.h: Mime type description chage to 'WPFe Plug-In' to handle 
	SilverLight objects.

2007-06-03  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin.c:
	* moon-plugin.h: Remove unused members to provide a clean code.

2007-06-03  Everaldo Canuto  <ecanuto@novell.com>

	* Makefile.am: Fix link options.

2007-06-03  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin-glue.c:
	* moon-plugin.c:
	* moon-plugin.h: Rename initialise to initialize.

	* Makefile.am: Add libmoon to link and install it on plugin dir.

2007-06-02  Everaldo Canuto  <ecanuto@novell.com>

	* moon-plugin-glue.c: Renamed to moon-plugin-glue.cpp.
	* moon-plugin.c: Renamed to moon-plugin.cpp.
	* Changelog: Create a separated change log for plugin.
	* Makefile.am: Renamed to moon-plugin.cpp.
	* moon-plugin.h: Renamed to moon-plugin.cpp.
	
	[Also add a sample to show libmoon features in browser]
